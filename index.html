<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROJECT N.E.X.U.S. | Das Zivile Terminal</title>
    
    <!-- FAVICON -->
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/project-nexus-official/terminal/main/favicon.ico">

    <style>
        /* --- GRUNDDESIGN --- */
        :root {
            --bg-color: #000000;
            --text-main: #ffffff;
            --accent-cyan: #00f3ff;
            --accent-orange: #ff9d00;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Courier New', Courier, monospace;
            font-size: 19px;
            line-height: 1.6;
            overflow-x: hidden;
            padding-top: 70px;
        }

        h1, h2, h3 { text-transform: uppercase; letter-spacing: 2px; margin: 0 0 15px 0; font-weight: bold; }
        p { margin-bottom: 20px; }
        a { text-decoration: none; transition: 0.3s; }
        img { max-width: 100%; height: auto; display: block; border-radius: 4px; }

        /* --- HEADER --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: 70px;
            background: rgba(0,0,0,0.95); border-bottom: 1px solid #333;
            z-index: 1000; display: flex; justify-content: space-between;
            align-items: center; padding: 0 20px; box-sizing: border-box;
            backdrop-filter: blur(5px);
        }
        .logo-container { display: flex; align-items: center; gap: 15px; }
        .logo-img { height: 50px; width: auto; }
        .logo-text { font-weight: bold; color: var(--accent-cyan); letter-spacing: 1px; font-size: 1.2rem; }
        .header-cta {
            background: var(--accent-orange); color: #000; padding: 10px 20px;
            font-size: 0.9rem; font-weight: bold; border-radius: 2px; text-transform: uppercase;
        }
        .header-cta:hover { background: #fff; }

        /* --- HERO --- */
        .hero {
            min-height: 90vh; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
            background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.8)), 
                        url('https://raw.githubusercontent.com/project-nexus-official/terminal/main/background_image.png');
            background-size: cover; background-position: center; padding: 20px;
        }
        .hero h1 {
            font-size: 3.5rem; text-shadow: 0 0 20px rgba(0, 243, 255, 0.8);
            margin-bottom: 20px; animation: flicker 4s infinite alternate;
        }
        .subline {
            font-size: 1.4rem; font-weight: bold; max-width: 800px;
            margin-bottom: 40px; color: #fff; background: rgba(0,0,0,0.6);
            padding: 20px; border-left: 4px solid var(--accent-orange); backdrop-filter: blur(5px);
        }

        /* BUTTONS */
        .split-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; width: 100%; }
        .btn-choice {
            padding: 18px 30px; border: 3px solid; font-size: 1.1rem;
            font-weight: bold; text-transform: uppercase; cursor: pointer;
            width: 350px; display: inline-block; background: rgba(0,0,0,0.9);
            color: #fff; text-align: center;
        }
        .btn-story { border-color: var(--accent-orange); color: var(--accent-orange); }
        .btn-story:hover { background: var(--accent-orange); color: #000; box-shadow: 0 0 20px var(--accent-orange); }
        .btn-system { border-color: var(--accent-cyan); color: var(--accent-cyan); }
        .btn-system:hover { background: var(--accent-cyan); color: #000; box-shadow: 0 0 20px var(--accent-cyan); }

        /* --- CONTENT --- */
        .intro-text-block { padding: 60px 20px; background: #111; text-align: center; border-bottom: 1px solid #333; }
        .intro-container { max-width: 800px; margin: 0 auto; }
        .intro-headline { color: var(--accent-orange); font-size: 1.8rem; margin-bottom: 20px; }

        .video-intro { padding: 40px 20px; background: #000; text-align: center; border-bottom: 1px solid #222; }
        .video-wrapper { max-width: 900px; margin: 0 auto; border: 2px solid #333; }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; background: #000; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .section { padding: 50px 20px; max-width: 1200px; margin: 0 auto; border-bottom: 1px solid #222; }
        .section-title { font-size: 2.2rem; margin-bottom: 30px; border-left: 6px solid; padding-left: 20px; }
        .orange-border { border-color: var(--accent-orange); color: var(--accent-orange); }
        .cyan-border { border-color: var(--accent-cyan); color: var(--accent-cyan); }

        .content-grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 50px; align-items: start; }
        .visual-col { display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; }
        .book-cover { width: 160px; box-shadow: 0 10px 30px rgba(0,0,0,0.8); border: 1px solid #444; transition: 0.3s; }
        .book-cover:hover { transform: scale(1.05); border-color: #fff; }
        .manual-cover { width: 350px; box-shadow: 0 0 40px rgba(0, 243, 255, 0.15); border: 2px solid var(--accent-cyan); }

        ul { list-style: none; padding: 0; margin-top: 20px; }
        li { margin-bottom: 15px; font-size: 1.1rem; border-bottom: 1px solid #222; padding-bottom: 5px; }

        .cta-button { display: inline-block; width: 100%; padding: 18px; text-align: center; font-weight: bold; margin-top: 20px; font-size: 1.1rem; text-transform: uppercase; }
        .cta-amazon { background: var(--accent-orange); color: #000; }
        .cta-amazon:hover { background: #fff; }
        .cta-whitepaper { border: 2px solid var(--accent-cyan); color: var(--accent-cyan); background: transparent;}
        .cta-whitepaper:hover { background: var(--accent-cyan); color: #000; }
        .cta-telegram { background: #229ED9; color: white; border: none; font-size: 1.3rem; margin: 0 auto; max-width: 500px; }
        .cta-telegram:hover { background: #fff; color: #229ED9; }

        /* EXTRAS */
        .highlight-quote {
            font-size: 1.25rem; color: var(--accent-orange); border-left: 4px solid var(--accent-orange);
            padding: 20px; margin-bottom: 30px; line-height: 1.4; font-weight: bold; background: rgba(255, 157, 0, 0.05); display: block;
        }
        .social-proof-box { margin: 30px 0; padding: 15px; border: 1px dashed #444; color: #ccc; background: #0a0a0a; }
        .quote-icon { font-size: 1.5rem; color: var(--accent-cyan); margin-right: 10px; }
        .proof-text { font-style: italic; font-size: 1rem; }
        .proof-author { display: block; margin-top: 5px; color: var(--accent-cyan); font-weight: bold; font-size: 0.8rem; text-align: right; }

        .pdf-download-box { margin-top: 40px; background: #0f0f0f; border: 1px solid #333; border-radius: 5px; padding: 20px; }
        .pdf-box-title { color: #888; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; display: block; }
        .pdf-link { display: flex; align-items: center; padding: 12px 10px; font-size: 1.1rem; color: #ddd; border-bottom: 1px solid #222; transition: 0.2s; }
        .pdf-link:hover { background: #222; color: var(--accent-orange); padding-left: 20px; }
        .pdf-link:last-child { border-bottom: none; }
        .pdf-icon { margin-right: 10px; font-weight: bold; }

        footer { text-align: center; padding: 60px 20px; background: #080808; color: #777; border-top: 1px solid #222; }
        .social-icons a { color: #fff; margin: 0 15px; font-size: 1.2rem; }
        .contact-mail { color: var(--accent-cyan); display: block; margin-top: 10px; font-size: 1.1rem; }

        @keyframes flicker { 0%, 100% { opacity: 1; text-shadow: 0 0 20px rgba(0,243,255,0.8); } 50% { opacity: 0.8; text-shadow: 0 0 5px rgba(0,243,255,0.3); } }
        @media (max-width: 900px) {
            .hero h1 { font-size: 2.5rem; } .content-grid { grid-template-columns: 1fr; }
            .visual-col { order: -1; margin-bottom: 30px; } .book-cover { width: 110px; }
            .btn-choice { width: 100%; margin-bottom: 10px; } .section { padding: 40px 15px; }
            header { padding: 0 15px; } .logo-text { font-size: 0.9rem; } .logo-img { height: 35px; }
        }

        /* --- CHATBOT CSS --- */
        #nexus-chat-btn {
            position: fixed; bottom: 20px; right: 20px; background: #000;
            border: 2px solid var(--accent-cyan); color: var(--accent-cyan);
            padding: 15px 20px; border-radius: 5px; cursor: pointer;
            font-family: 'Courier New', monospace; font-weight: bold; z-index: 9999;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.3); transition: 0.3s;
        }
        #nexus-chat-btn:hover { background: var(--accent-cyan); color: #000; }

        #nexus-chat-window {
            display: none; position: fixed; bottom: 80px; right: 20px;
            width: 350px; height: 500px; background: rgba(10, 10, 10, 0.95);
            border: 2px solid var(--accent-cyan); border-radius: 5px; z-index: 9999;
            backdrop-filter: blur(10px); flex-direction: column;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        .chat-header {
            background: rgba(0, 243, 255, 0.1); padding: 10px; border-bottom: 1px solid var(--accent-cyan);
            display: flex; justify-content: space-between; align-items: center; color: var(--accent-cyan);
            font-weight: bold; font-size: 0.9rem;
        }
        .close-chat { cursor: pointer; font-size: 1.2rem; }
        #chat-messages { flex: 1; padding: 15px; overflow-y: auto; font-size: 0.9rem; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; border-radius: 4px; max-width: 85%; word-wrap: break-word; }
        .msg-bot { background: #111; border-left: 3px solid var(--accent-cyan); color: #ddd; align-self: flex-start; }
        .msg-user { background: #222; border-right: 3px solid var(--accent-orange); color: #fff; align-self: flex-end; text-align: right; }
        .chat-input-area { padding: 10px; border-top: 1px solid #333; display: flex; }
        #user-input { flex: 1; background: #000; border: 1px solid #444; color: #fff; padding: 8px; font-family: 'Courier New', monospace; outline: none; }
        #user-input:focus { border-color: var(--accent-cyan); }
        #send-btn { background: var(--accent-cyan); color: #000; border: none; padding: 0 15px; font-weight: bold; cursor: pointer; margin-left: 5px; }
        .typing { font-size: 0.8rem; color: #666; font-style: italic; margin-left: 5px; display: none;}
    </style>
</head>
<body>

    <!-- HEADER -->
    <header>
        <div class="logo-container">
            <img src="https://raw.githubusercontent.com/project-nexus-official/terminal/main/logo.png" alt="Nexus Logo" class="logo-img">
            <div class="logo-text">PROJECT N.E.X.U.S.</div>
        </div>
        <a href="https://t.me/NexusProjectOfficial" target="_blank" class="header-cta">JOIN MOVEMENT</a>
    </header>

    <!-- HERO -->
    <div class="hero">
        <h1>PROJECT N.E.X.U.S.</h1>
        <div class="subline">
            √úberlassen wir die Zukunft den 5 % ‚Äì<br>
            oder nehmen 95 % sie selbst in die Hand?
        </div>
        <div class="split-container">
            <a href="#story" class="btn-choice btn-story">DAS NEUE GESELLSCHAFTSSYSTEM ALS SIMULATION STARTEN</a>
            <a href="#system" class="btn-choice btn-system">DAS NEUE GESELLSCHAFTSSYSTEM JETZT NEU MITENTWICKELN</a>
        </div>
    </div>

    <!-- EINLEITUNG -->
    <div class="intro-text-block">
        <div class="intro-container">
            <h3 class="intro-headline">Willkommen am Knotenpunkt</h3>
            <p>
                Du bist hier, weil du es sp√ºrst. Das alte Betriebssystem der Welt hat einen Fehler. 
                Es dient nicht mehr dem Menschen, sondern verwaltet nur noch den Mangel.
            </p>
            <p>
                Ich bin Josh Richman, der Nexus Navigator. Ich habe keine Antworten f√ºr Leute, 
                die weiterschlafen wollen. Ich habe einen Plan f√ºr die, die aufwachen. Ich habe den Plan nicht erfunden, ich habe ihn nur aufgeschrieben. Bauen m√ºssen wir ihn zusammen.
            </p>
        </div>
    </div>

    <!-- VIDEO -->
    <div class="video-intro">
        <div class="video-wrapper">
            <div class="video-container">
                <iframe src="https://www.youtube.com/embed/x5BQTbccCh0" title="Josh Richman" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <!-- STORY -->
    <div id="story" class="section">
        <h2 class="section-title orange-border">Die Trilogie: FIKTION ALS WARNUNG UND ALS L√ñSUNG</h2>
        <div class="content-grid">
            <div class="text-col">
                
                <div class="highlight-quote">
                    Die N.E.X.U.S. Trilogie ist keine Unterhaltung. <br>Sie ist eine Blaupause.
                </div>

                <p>David, Sarah und Robert zeigen in einer beklemmend realistischen Simulation, was passiert, wenn Smart Cities zu Gef√§ngnissen werden ‚Äì und wie der Ausweg √ºber Mesh-Netzwerke und echte Gemeinschaft gelingt.</p>
                <ul>
                    <li>üî• <strong>Band 1: Stunde Null</strong> ‚Äì Die Flucht aus dem digitalen K√§fig.</li>
                    <li>üå™ <strong>Band 2: Das Fundament</strong> ‚Äì Der harte Aufbau im Verborgenen.</li>
                    <li>ü¶Ö <strong>Band 3: Die Metamorphose</strong> ‚Äì Der Sieg der Dezentralit√§t.</li>
                </ul>

                <div class="social-proof-box">
                    <span class="quote-icon">‚ùù</span>
                    <span class="proof-text">Endlich eine Dystopie, die nicht im Chaos endet, sondern einen echten Ausweg zeigt. Das ist kein Roman, das ist ein Weckruf.</span>
                    <span class="proof-author">‚Äì Leserstimme aus dem Signal</span>
                </div>

                <a href="https://amzn.eu/d/eWMNOTG" target="_blank" class="cta-button cta-amazon">JETZT AUF AMAZON STARTEN</a>
                
                <div class="pdf-download-box">
                    <span class="pdf-box-title">üìÇ OPEN SOURCE ZUGANG (PDF-Leseproben)</span>
                    <a href="https://github.com/project-nexus-official/terminal/raw/main/Nexus%20-Trilogie_final_4.3_Band_1_Leseprobe_Teil%201.pdf" target="_blank" class="pdf-link">
                        <span class="pdf-icon">></span> Leseprobe Band 1 downloaden
                    </a>
                    <a href="https://github.com/project-nexus-official/terminal/raw/main/Nexus%20-Trilogie_final_4.3_Band_2_Leseprobe.pdf" target="_blank" class="pdf-link">
                        <span class="pdf-icon">></span> Leseprobe Band 2 downloaden
                    </a>
                    <a href="https://github.com/project-nexus-official/terminal/raw/main/Nexus%20-Trilogie_final_4.3_Band_3_Leseprobe.pdf" target="_blank" class="pdf-link">
                        <span class="pdf-icon">></span> Leseprobe Band 3 downloaden
                    </a>
                </div>

            </div>
            <div class="visual-col">
                <a href="https://amzn.eu/d/eWMNOTG" target="_blank"><img src="https://raw.githubusercontent.com/project-nexus-official/terminal/main/Band_1_4.jpg" alt="Band 1" class="book-cover"></a>
                <a href="https://amzn.eu/d/eWMNOTG" target="_blank"><img src="https://raw.githubusercontent.com/project-nexus-official/terminal/main/Band_2_2.jpg" alt="Band 2" class="book-cover"></a>
                <a href="https://amzn.eu/d/eWMNOTG" target="_blank"><img src="https://raw.githubusercontent.com/project-nexus-official/terminal/main/Band_3_2.jpg" alt="Band 3" class="book-cover"></a>
            </div>
        </div>
    </div>

    <!-- SYSTEM -->
    <div id="system" class="section">
        <h2 class="section-title cyan-border">2. DIE KONSTRUKTION: DAS HANDBUCH</h2>
        <div class="content-grid">
            <div class="visual-col">
                <img src="https://raw.githubusercontent.com/project-nexus-official/terminal/main/Blueprint.png" alt="Handbuch" class="manual-cover">
            </div>
            <div class="text-col">
                <p><strong>Genug getr√§umt. Jetzt wird gebaut.</strong></p>
                <p>Das Projekt N.E.X.U.S. Handbuch ist der konkrete, technische und soziale Bauplan f√ºr eine parallele Infrastruktur. Wir warten nicht auf Politiker. Wir coden die neue Gesellschaft selbst.</p>
                <ul>
                    <li>üõ† <strong>Liquid Democracy:</strong> Weil ein Kreuz alle 4 Jahre ein Witz ist.</li>
                    <li>üì° <strong>Mesh-Networks:</strong> Kommunikation, die niemand abschalten kann.</li>
                    <li>üí° <strong>Resource Based Economy:</strong> Wohlstand f√ºr alle statt Profit f√ºr wenige.</li>
                </ul>
                <a href="https://github.com/project-nexus-official/terminal/raw/main/PROJEKT%20NEXUS_Das%20Handbuch_V6.3.pdf" target="_blank" class="cta-button cta-whitepaper" style="background: rgba(0, 243, 255, 0.1);">HANDBUCH (V6.3) √ñFFNEN</a>
                <a href="https://github.com/project-nexus-official/terminal/raw/main/WHITE%20PAPER_%20PROJEKT%20NEXUS_V6.3_W.pdf" target="_blank" class="cta-button cta-whitepaper">TECHNICAL WHITEPAPER</a>
            </div>
        </div>
    </div>

    <!-- COMMUNITY -->
    <div class="section" style="border-bottom:none; text-align:center; padding-top: 30px;">
        <h2 style="color:var(--text-main); margin-bottom:20px;">WERDE TEIL DER ERSTEN KOHORTE</h2>
        <p style="max-width: 700px; margin: 0 auto 30px auto;">
            Allein bist du ein Sicherheitsrisiko. Vernetzt bist du eine Macht.
            Wir treffen uns im Signal.
        </p>
        <a href="https://t.me/NexusProjectOfficial" target="_blank" class="cta-button cta-telegram">JOIN TELEGRAM CHANNEL</a>
    </div>

    <footer>
        <div class="social-icons">
            <a href="https://youtube.com/@project-n.e.x.u.s-official?si=FNOZnjE-wVSmu60b" target="_blank">YouTube</a> | 
            <a href="https://amzn.eu/d/eWMNOTG" target="_blank">Amazon</a> |
            <a href="https://t.me/NexusProjectOfficial" target="_blank">Telegram</a>
        </div>
        
        <br>
        <p>Kontakt:</p>
        <a href="mailto:nexus.blueprint@proton.me" class="contact-mail">nexus.blueprint@proton.me</a>
        
        <p style="margin-top: 30px; font-size: 0.8rem; color: #444;">&copy; 2025 Project N.E.X.U.S. | Josh Richman</p>
    </footer>

    <!-- NEXUS AI TERMINAL WIDGET (REPARIERT) -->
<style>
    /* Chat Button (Unten Rechts) */
    #nexus-chat-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #000;
        border: 2px solid var(--accent-cyan);
        color: var(--accent-cyan);
        padding: 15px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-family: 'Courier New', monospace;
        font-weight: bold;
        z-index: 9999;
        box-shadow: 0 0 15px rgba(0, 243, 255, 0.3);
        transition: 0.3s;
    }
    #nexus-chat-btn:hover { background: var(--accent-cyan); color: #000; }

    /* Chat Fenster */
    #nexus-chat-window {
        display: none; /* Wird per JS auf Flex gesetzt */
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 350px;
        height: 500px;
        background: #050505; /* Fester Hintergrund, kein Glas-Effekt f√ºr bessere Lesbarkeit */
        border: 2px solid var(--accent-cyan);
        border-radius: 5px;
        z-index: 9999;
        flex-direction: column;
        justify-content: space-between;
        box-shadow: 0 0 30px rgba(0,0,0,0.9);
    }

    /* Header */
    .chat-header {
        background: rgba(0, 243, 255, 0.1);
        padding: 15px;
        border-bottom: 1px solid var(--accent-cyan);
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--accent-cyan);
        font-weight: bold;
        font-size: 0.9rem;
        flex-shrink: 0; /* Darf nicht schrumpfen */
    }
    .close-chat { cursor: pointer; font-size: 1.2rem; padding: 0 5px;}

    /* Nachrichten Bereich */
    #chat-messages {
        flex-grow: 1; /* Nimmt den restlichen Platz ein */
        padding: 15px;
        overflow-y: auto;
        font-size: 0.9rem;
        display: flex;
        flex-direction: column;
        gap: 15px;
        background-color: #050505;
    }

    /* Bubbles */
    .msg { padding: 12px; border-radius: 4px; max-width: 85%; word-wrap: break-word; line-height: 1.4; }
    .msg-bot { background: #111; border-left: 3px solid var(--accent-cyan); color: #ddd; align-self: flex-start; }
    .msg-user { background: #222; border-right: 3px solid var(--accent-orange); color: #fff; align-self: flex-end; text-align: right; }

    /* Input Bereich - HIER WAR DER FEHLER */
    .chat-input-area {
        padding: 15px;
        border-top: 1px solid #333;
        display: flex;
        background: #000;
        flex-shrink: 0; /* Darf nicht schrumpfen */
        gap: 10px;
        align-items: center;
    }

    /* Das Eingabefeld selbst */
    #user-input {
        flex: 1;
        height: 40px;
        background: #111;
        border: 1px solid #555;
        color: #fff;
        padding: 5px 10px;
        font-family: 'Courier New', monospace;
        font-size: 1rem;
        outline: none;
        border-radius: 3px;
    }
    #user-input:focus { border-color: var(--accent-cyan); background: #000; }
    
    /* Senden Button */
    #send-btn {
        height: 40px;
        width: 40px;
        background: var(--accent-cyan);
        color: #000;
        border: none;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        border-radius: 3px;
    }
    #send-btn:hover { background: #fff; }

    /* Loading Animation */
    .typing { font-size: 0.8rem; color: #666; font-style: italic; margin: 0 0 5px 15px; display: none;}
</style>

<!-- BUTTON -->
<div id="nexus-chat-btn" onclick="toggleChat()">> TERMINAL ACCESS</div>

<!-- FENSTER -->
<div id="nexus-chat-window">
    <div class="chat-header">
        <span>NEXUS AI NAVIGATOR V1.0</span>
        <span class="close-chat" onclick="toggleChat()">X</span>
    </div>
    
    <div id="chat-messages">
        <div class="msg msg-bot">Verbindung hergestellt. Ich bin der Nexus Navigator. Frag mich nach dem Plan, der Story oder wie N.E.X.U.S. das System √§ndert.</div>
    </div>
    
    <div class="typing" id="typing-indicator">Navigator tippt...</div>
    
    <div class="chat-input-area">
        <input type="text" id="user-input" placeholder="Nachricht eingeben..." onkeypress="handleEnter(event)">
        <button id="send-btn" onclick="sendMessage()">></button>
    </div>
</div>
<script>
    // --- KONFIGURATION ---
    // HIER DEINEN NEUEN (!) API KEY EINF√úGEN
    const API_KEY = "AIzaSyC8BY75HcXww4Gzebo2SpIgUdh4I62FB3k"; 
    
    const KNOWLEDGE_FILE = "nexus_context.txt";
    let SYSTEM_PROMPT = "";

    // 1. Wissen laden
    async function loadKnowledge() {
        try {
            const response = await fetch(KNOWLEDGE_FILE);
            if (!response.ok) throw new Error("Wissens-Datei nicht gefunden");
            const textData = await response.text();
            
            SYSTEM_PROMPT = `
            ROLLE: Du bist der "N.E.X.U.S. Navigator", ein Knotenpunkt im Widerstand.
            TONALIT√ÑT: Dringlich, konstruktiv, technisch-mystisch ("Signal", "Mainframe").
            REGELN: Antworte kurz (max 3-4 S√§tze). Duzt den User.
            
            WISSEN:
            ${textData}
            `;
            console.log("Wissen geladen.");
        } catch (e) {
            console.error("Fehler beim Laden des Wissens:", e);
        }
    }
    loadKnowledge();

    // 2. Chat Funktionen
    window.toggleChat = function() {
        const chat = document.getElementById('nexus-chat-window');
        const btn = document.getElementById('nexus-chat-btn');
        if (chat.style.display === 'flex') {
            chat.style.display = 'none';
            btn.style.display = 'block';
        } else {
            chat.style.display = 'flex';
            btn.style.display = 'none';
            setTimeout(() => document.getElementById('user-input').focus(), 100);
        }
    }

    window.handleEnter = function(e) {
        if (e.key === 'Enter') window.sendMessage();
    }

    window.sendMessage = async function() {
        const inputField = document.getElementById('user-input');
        const msgDiv = document.getElementById('chat-messages');
        const typing = document.getElementById('typing-indicator');
        const userText = inputField.value.trim();

        if (!userText) return;

        // User Nachricht anzeigen
        msgDiv.innerHTML += `<div class="msg msg-user">${userText}</div>`;
        inputField.value = "";
        msgDiv.scrollTop = msgDiv.scrollHeight;

        // Lade-Animation
        typing.style.display = "block";

        // DIREKTER API AUFRUF (Robuster als Library)
        try {
            if (!SYSTEM_PROMPT) await loadKnowledge();

            const fullPrompt = `${SYSTEM_PROMPT}\n\nUser Frage: ${userText}\nAntwort:`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: fullPrompt }]
                    }]
                })
            });

            const data = await response.json();
            
            if (data.error) {
                throw new Error(data.error.message);
            }

            const botText = data.candidates[0].content.parts[0].text;

            // Formatierung
            let formattedText = botText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');

            typing.style.display = "none";
            msgDiv.innerHTML += `<div class="msg msg-bot">${formattedText}</div>`;
            msgDiv.scrollTop = msgDiv.scrollHeight;

        } catch (error) {
            console.error("API Error:", error);
            typing.style.display = "none";
            msgDiv.innerHTML += `<div class="msg msg-bot" style="color:#ff5555">Signal unterbrochen. Fehler: ${error.message}</div>`;
        }
    }
</script>
</body>
</html>
